---
title: "R Notebook"
output: html_notebook
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)

require(tidyverse)
require(tidymodels)
require(data.table)
require(data.tree)
require(DataExplorer)
require(C50)
require(indicspecies)
require(doParallel)
require(philentropy)
require(dplyr)
```

```{r}
source("CodeUsingTreeFunctions.R")
```


```{r}
source("./_functions/_TabletoTree.R")
source("./_functions/_TreetoTable.R")
source("./_functions/_VegdatSUsummary.R") 
source("./_functions/_spp_importance.R")
source("./_functions/_CreateHierReportData.R")
```

```{r Create Hier Report and produce plot numbers in level}

# Need to do for each level for each level_value in level
level_name <- "Order"
level_value <- "ORDER Poputre"

unique_classes <- unique(Hier.data[["Class"]])
unique_orders <- unique(Hier.data[["Order"]])
unique_suborder <- unique(Hier.data[["Suborder"]])
unique_alliance <- unique(Hier.data[["Alliance"]])
unique_assoc <- unique(Hier.data[["Assoc"]])


createHierReportData(level_name, level_value, SUTab)


#lapply(uniqueClasses, createReportData(levelName))

```



```{r Plot data sets}
ENV_Plot_data <- fread("./BEC_ReportR/Plot_Data/BECMaster19_ENV.csv")
Humus_Plot_data <- fread("./BEC_ReportR/Plot_Data/BECMaster19_Humus.csv")
Mineral_Plot_data <- fread("./BEC_ReportR/Plot_Data/BECMaster19_Mineral.csv")
Climate_Plot_data <- fread("./BEC_ReportR/Plot_Data/BECMaster_Plot_Climatedata.csv")
```


```{r}
# Get plot_numbers_in_level
plot_numbers_file_name <- paste("plot_numbers_in", str_replace_all(level_value, " ", "_"), ".RDS", sep="")
plot_numbers_in_level <- readRDS(file.path("plotNumbers", level_name, plot_numbers_file_name))


# Get relevant plot data rows from each Plot data file
ENV_Plot_data_for_level <- ENV_Plot_data[ENV_Plot_data$PlotNumber %in% plot_numbers_in_level]
Humus_Plot_data_for_level <- Humus_Plot_data[Humus_Plot_data$PlotNumber %in% plot_numbers_in_level]
Mineral_Plot_data_for_level <- Mineral_Plot_data[Mineral_Plot_data$PlotNumber %in% plot_numbers_in_level]
Climate_Plot_data_for_level <-  Climate_Plot_data[ Climate_Plot_data$PlotNumber %in% plot_numbers_in_level]
  
# Write relevant plot data rows from each Plot
```



```{r Create env variable functions data frame}
# This prints env variable names to a list. A JASON doc is then created manually 

#reports_dir <- file.path("reports", level_name) 
#if (!dir.exists(reports_dir)) dir.create(reports_dir, recursive = TRUE)

env_names <- names(ENV_Plot_data)

env_names_list <- list()
for (name in env_names) {
  
  print(name)
  env_names_list[[ name[1] ]] <- "[]"

}
 
print(env_names_list) 

env_variables_summary_functions <- data.frame(variable_name=names(ENV_Plot_data))
write.csv(env_variables_summary_functions,"./env_variables_summary_functions.csv", row.names = FALSE)

humus_variables_summary_functions <- data.frame(variable_name=names(Humus_Plot_data))
write.csv(humus_variables_summary_functions,"./humus_variables_summary_functions.csv", row.names = FALSE)

mineral_variables_summary_functions <- data.frame(variable_name=names(Mineral_Plot_data))
write.csv(humus_variables_summary_functions,"./humus_variables_summary_functions.csv", row.names = FALSE)
```




```{r summerize plot data file test}
x <- c("A", "B", "G")
y <- c(5, 3, 7)
z <- c("A", "X", "Z")
r <- c("A", "T", "T")

rolled_up_list <- list()


df <- data.frame(x, y, z, r)
lookup_df <- data.frame(variable_name=c("x", "y", "z", "r"), function_name=c("table", "min", "table", "table"))

for (name in names(df)) {
  
  fun <- lookup_df %>% filter(variable_name == name) %>% pull("function_name")
  rolled_up_list <- append(rolled_up_list, list(do.call(fun, df[name])))
}

print(rolled_up_list)


```


```{r}
library(jsonlite)

json <- '{"name": "Oamar", "dob": "June 20 1994", "age": 27, "interests": ["bike", "ski", "code"]}'
fromJSON(json, simplifyVector = FALSE)

```


